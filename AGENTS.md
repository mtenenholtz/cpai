# Repository Guidelines

## Project Structure & Module Organization
- `src/cli.ts` — CLI entrypoint (`init`, `scan`, `copy`, `tui`).
- `src/ui/` — interactive TUI implementation
  - `src/ui/adapter.ts` — UI adapter (Ink-backed)
  - `src/ui/ink/` — Ink components, hooks, and app shell
  - `src/ui/core/` — state, actions, selectors, tree helpers
- `src/lib/` — helpers: `scan.ts` (globs + token counts), `format.ts` (render/pack/XML/tags), `config.ts`, `tokenizer.ts`, `utils.ts`.
- `src/types.ts` — TypeScript types shared across modules.
- `dist/` — compiled JS; do not edit. Generated by `pnpm run build`.
 - Optional config files: `.cpairc.json`; ignore rules via `.cpaiignore` plus `.gitignore`.

## Build, Test, and Development Commands
- `pnpm install` — install dependencies (Node ≥ 18.18).
- `pnpm run build` — compile TypeScript to `dist/` via `tsc`.
- `pnpm run dev` — run the CLI in dev mode (`tsx src/cli.ts --help`).
- `pnpm start` — run compiled CLI (`node dist/cli.js`).
- Global link (optional): `pnpm link --global` then use `cpai`.
- Quick examples: `cpai scan . --by-dir`, `cpai copy . --max-tokens 120000`, `cpai tui .`.

 Note: After making changes that require compilation (TypeScript or build‑affecting config), always run `pnpm run build` (aka `pnpm build`) to refresh `dist/` before using `pnpm start` or the globally linked `cpai`.

## Coding Style & Naming Conventions
- Language: TypeScript (strict), ESM (`type: module`, `moduleResolution: NodeNext`).
- Indentation: 2 spaces; include semicolons; prefer single quotes or consistent string style.
- Exports: prefer named exports; avoid default exports for libraries in `src/lib/`.
- Filenames: lowercase, short; prefer `kebab-case` if multiword (e.g., `file-picker.ts`).
- Types/Interfaces use `PascalCase`; variables/functions use `camelCase`.
- No linter configured; follow existing style. If adding tooling, prefer ESLint + Prettier with minimal rules.

## Testing Guidelines
- Vitest is configured (see `package.json`).
- Run tests: `pnpm test` (or `pnpm coverage` for HTML/LCOV reports).
- Location: `src/**/*.test.ts` (co-located with sources).
- Naming: mirror source name (e.g., `utils.test.ts`).

## Commit & Pull Request Guidelines
- Use Conventional Commits: `feat(cli): add --xml output`, `fix(scan): handle too-large`, `docs: update README`.
- PRs must include: clear description, rationale, CLI/TUI examples (and screenshots for TUI changes), updated docs (`README.md`/help text), and tests if behavior changes.
- Keep changes focused; do not commit built artifacts in `dist/`.

## Security & Configuration Tips
 - Avoid leaking secrets: review `--include/--exclude`, `.gitignore`, and `.cpaiignore`. Run `cpai scan` before `cpai copy`.
 - Large/binary files are skipped by default; adjust via `.cpairc.json` (`maxBytesPerFile`, `exclude`).
